$(function(){function e(){for(var e="#",t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],a=0;a<6;a++){var r=Math.round(15*Math.random());e+=t[r]}return e}var t=location.search;t=t.slice(4),$("#send").on("touchend",function(){var e={info:$("#content_chat").val(),close:!0,speed:6,color:"#fff",old_ie_color:"#000000"};$("body").barrager(e)}),$.ajax({url:"http://api.bilibili.com/playurl",type:"GET",data:{aid:t,page:1,platform:"html5",quality:"2",vtype:"mp4",type:"jsonp",token:window.token||""},dataType:"jsonp",beforeSend:function(){},success:function(t){console.log(t),"playurl bad request"==t.message||"bad request"==t.message?$("#display .title").html("<h3>加载失败！资源可能失效！</h3>"):($("#display .video").attr("poster",t.img),$("#display .video").html("<source src="+t.durl[0].url+">"),$.ajax({url:t.cid,type:"GET",success:function(t){for(var a=t.getElementsByTagName("d"),r=[],n=0,o=a.length;n<o;n++){var i=a[n].outerHTML,s=i.indexOf('"'),l=i.indexOf('"',s+1);i=i.slice(s+1,l).split(","),i.push(a[n].innerHTML),r.push(i)}$(".video")[0].addEventListener("timeupdate",function(){startTime=i[4];for(var t in r){r[t][4]-startTime>=0?r[t][4]:r[t][5];if(parseInt(r[t][4]-startTime)<=this.currentTime){var a=document.createElement("li");return a.innerHTML=r[t][8],$(".barrage_c").append(a),$(a).css({position:"absolute",right:"-100vw",color:e(),top:80*Math.random()+"%"}).animate({left:-1e3},15e3,function(){$(this).remove()}),void r.shift()}}})}}))}})});